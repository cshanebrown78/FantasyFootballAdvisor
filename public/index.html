<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="./styles/style.css">
    <title>Home Page</title>
</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo01"
            aria-controls="navbarTogglerDemo01" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            <a class="navbar-brand" >Fantasy Football Advisor</a>
            <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                <li class="nav-item active">
                    <a class="nav-link" id="homeLink" href="/">Home <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="clubhouseLink" >Club House</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" id="draftroomLink" >Draftroom</a>
                </li>
            </ul>
            <!-- FUTURE DEVELOPMENT 
                <form class="form-inline my-2 my-lg-0">
                <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
            </form> -->
        </div>
    </nav>
    <div class="jumbotron jumbotron-fluid">
        <div class="container">
            <h1 class="display-4"></h1>
        </div>
    </div>
    <div class="cotn_principal">
        <div class="cont_centrar">

            <div class="cont_login">
                <div class="cont_info_log_sign_up">
                    <div class="col_md_login">
                        <div class="cont_ba_opcitiy">

                            <h2>LOGIN</h2>
                            <p>Returning users sign in!</p>
                            <button class="btn_login" onclick="cambiar_login()">LOGIN</button>
                        </div>
                    </div>
                    <div class="col_md_sign_up">
                        <div class="cont_ba_opcitiy">
                            <h2>SIGN UP</h2>


                            <p>New users sign up!</p>

                            <button class="btn_sign_up" onclick="cambiar_sign_up()">SIGN UP</button>
                        </div>
                    </div>
                </div>


                <div class="cont_back_info">
                    <div class="cont_img_back_grey">
                        <img src="https://images.unsplash.com/42/U7Fc1sy5SCUDIu4tlJY3_NY_by_PhilippHenzler_philmotion.de.jpg?ixlib=rb-0.3.5&q=50&fm=jpg&crop=entropy&s=7686972873678f32efaf2cd79671673d"
                            alt="" />
                    </div>

                </div>
                <div class="cont_forms">
                    <div class="cont_img_back_">
                        <img src="https://images.unsplash.com/42/U7Fc1sy5SCUDIu4tlJY3_NY_by_PhilippHenzler_philmotion.de.jpg?ixlib=rb-0.3.5&q=50&fm=jpg&crop=entropy&s=7686972873678f32efaf2cd79671673d"
                            alt="" />
                    </div>
                    <div class="cont_form_login">
                        <a onclick="ocultar_login_sign_up()"><i class="material-icons">&#xE5C4;</i></a>
                        <h2>LOGIN</h2>
                        <input type="text" id="returningUserName" placeholder="Username" />
                        <input type="password" id="returningUserPassword" placeholder="Password" />
                        <button class="btn_login" id="logIn">LOGIN</button>
                    </div>

                    <div class="cont_form_sign_up">
                        <a onclick="ocultar_login_sign_up()"><i class="material-icons">&#xE5C4;</i></a>
                        <h2>SIGN UP</h2>
                        <input type="text" id="newUserName" placeholder="Username" />
                        <input type="password" id="newUserPassword" placeholder="Password" />
                        <input type="password" id="newUserPasswordConfirm" placeholder="Confirm Password" />
                        <button class="btn_sign_up" id="signUp">SIGN UP</button>

                    </div>

                </div>

            </div>
        </div>
    </div>
</body>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous"></script>
<script>

    function cambiar_login() {
        document.querySelector('.cont_forms').className = "cont_forms cont_forms_active_login";
        document.querySelector('.cont_form_login').style.display = "block";
        document.querySelector('.cont_form_sign_up').style.opacity = "0";

        setTimeout(function () {
            document.querySelector('.cont_form_login').style.opacity = "1";
        }, 400);

        setTimeout(function () {
            document.querySelector('.cont_form_sign_up').style.display = "none";
        }, 200);
    }

    function cambiar_sign_up(at) {
        document.querySelector('.cont_forms').className = "cont_forms cont_forms_active_sign_up";
        document.querySelector('.cont_form_sign_up').style.display = "block";
        document.querySelector('.cont_form_login').style.opacity = "0";

        setTimeout(function () {
            document.querySelector('.cont_form_sign_up').style.opacity = "1";
        }, 100);

        setTimeout(function () {
            document.querySelector('.cont_form_login').style.display = "none";
        }, 400);


    }



    function ocultar_login_sign_up() {
        document.querySelector('.cont_forms').className = "cont_forms";
        document.querySelector('.cont_form_sign_up').style.opacity = "0";
        document.querySelector('.cont_form_login').style.opacity = "0";

        setTimeout(function () {
            document.querySelector('.cont_form_sign_up').style.display = "none";
            document.querySelector('.cont_form_login').style.display = "none";
        }, 500);

    }

    $("#logIn").on("click", function() {
        event.preventDefault();
        var currentURL = window.location

        var returningUserName = $("#returningUserName").val().trim();
        var returningUserPassword = $("#returningUserPassword").val().trim();

        var returningUser = {
            userName: returningUserName,
            password: returningUserPassword
        }
        

        $.get("api/users", function(res) {
            
            let obj = res.find(o => o.userName === returningUser.userName && o.password === returningUser.password);
            console.log(obj)
            if (obj === undefined) {
                var wrongUserOrPass = $("<p>");
                wrongUserOrPass.text("Either the username or password are incorrect. Please try agian.");
                $(".cont_form_login").append(wrongUserOrPass);
            } else {
                var loggedIn = $("<p>");
                loggedIn.text("Logged in. Warning: returning to the home page will log you out of your current session");
                $(".cont_form_login").append(loggedIn);
                $("#clubhouseLink").attr("href", "/clubhouse");
                $("#draftroomLink").attr("href", "/draft");
                redirect();
            }
        })
        
    });

    function redirect() {
        window.location.pathname = '/clubhouse'
    }

    $("#signUp").on("click", function() {
        var currentURL = window.location;
        var newUserName = $("#newUserName").val().trim();
        var newUserPassword = $("#newUserPassword").val().trim();
        var newUserPasswordConfirm = $("#newUserPasswordConfirm").val().trim();
        var newUser = {
            userName: newUserName,
            password: newUserPassword
        }
        console.log(newUser)
        var passwordsDontMatch = $("<p>");
        passwordsDontMatch.text("Sorry, passwords do not match. Please try again.");
        if (newUserPassword == newUserPasswordConfirm) {
            $.post(currentURL + "api/users", newUser);
            $("#newUserName").val("");
            $("#newUserPassword").val("");
            $("#newUserPasswordConfirm").val("");
            $("#clubhouseLink").attr("href", "/clubhouse");
            $("#draftroomLink").attr("href", "/draft");
            redirect();
        } else {
            $(".cont_form_sign_up").append(passwordsDontMatch);
        }
    })

</script>

</html>